---
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";
import Layout from "../../layouts/Layout.astro";
import Navigation from "../../components/Navigation.vue";
import Footer from "../../components/Footer.astro";

export const getStaticPaths = (async ({ paginate }) => {
  const posts = (await getCollection("blog"))
    .filter((post) => !post.data.draft)
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

  return paginate(posts, { pageSize: 10 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<Layout title="News - Logic Moon">
  <Navigation client:visible />
  <main class="min-h-screen bg-secondary-400">
    <section class="main-section">
      <div class="container mx-auto px-4 py-16">
        <h1
          class="cinzel text-4xl md:text-6xl text-center mb-12 text-primary-500">
          News
        </h1>

        <div
          class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
          {
            page.data.map((post) => (
              <article class="post-card bg-primary-200 overflow-hidden shadow-lg group cursor-pointer transition-colors duration-300 hover:bg-secondary-100">
                <a href={`/news/${post.slug}`} class="block hover:no-underline focus:outline-none focus:ring-2 focus:ring-primary-500 rounded-lg" aria-label={`Read more about ${post.data.title}`}>
                  {post.data.image && (
                    <div class="aspect-video overflow-hidden">
                      <img
                        src={post.data.image}
                        alt={post.data.title}
                        class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                      />
                    </div>
                  )}
                  <div class="p-6">
                    <h2 class="text-xl font-semibold mb-3 text-primary-500 group-hover:text-secondary-900 transition-colors duration-200">
                        {post.data.title}
                    </h2>
                    <p class="text-grey-500 group-hover:text-secondary-700 text-sm mb-3 transition-colors duration-200">
                      {post.data.pubDate.toLocaleDateString("de-DE", {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                      })}
                    </p>
                    <p class="text-grey-600 group-hover:text-secondary-800 leading-relaxed transition-colors duration-200">
                      {post.data.description}
                    </p>
                  </div>
                </a>
              </article>
            ))
          }
        </div>

        <nav class="flex items-center justify-center gap-4 mt-16">
          {
            page.url.prev && (
              <a
                href={page.url.prev}
                class="bg-primary-500 hover:bg-primary-400 text-white px-6 py-2 rounded transition-colors duration-200">
                ← Vorherige
              </a>
            )
          }

          <div class="flex gap-2">
            {
              Array.from({ length: page.lastPage }, (_, i) => i + 1).map(
                (num) => (
                  <a
                    href={num === 1 ? "/news" : `/news/${num}`}
                    class={`w-10 h-10 flex items-center justify-center rounded transition-colors duration-200 ${
                      num === page.currentPage
                        ? "bg-primary-500 text-white"
                        : "bg-white text-primary-500 hover:bg-primary-100"
                    }`}>
                    {num}
                  </a>
                )
              )
            }
          </div>

          {
            page.url.next && (
              <a
                href={page.url.next}
                class="bg-primary-500 hover:bg-primary-400 text-white px-6 py-2 rounded transition-colors duration-200">
                Nächste →
              </a>
            )
          }
        </nav>

        <p class="text-center text-grey-600 mt-8">
          Seite {page.currentPage} von {page.lastPage}
          (Artikel {page.start + 1}-{page.end + 1} von {page.total})
        </p>
      </div>
    </section>
  </main>
  <Footer />
</Layout>

<style>
  .main-section {
    min-height: calc(100vh - 80px);
  }
</style>

<style>
  /* main {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
  }

  .posts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin: 2rem 0;
  }

  .post-card {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.2s;
  }

  .post-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }

  .post-card img {
    width: 100%;
    height: 200px;
    object-fit: cover;
  }

  .post-content {
    padding: 1.5rem;
  }

  .post-content h2 {
    margin: 0 0 0.5rem 0;
  }

  .post-content h2 a {
    text-decoration: none;
    color: #333;
  }

  .post-content h2 a:hover {
    color: #007acc;
  }

  .post-meta {
    color: #666;
    font-size: 0.9rem;
    margin: 0 0 1rem 0;
  }

  .pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    margin: 3rem 0 1rem 0;
  }

  .pagination-numbers {
    display: flex;
    gap: 0.5rem;
  }

  .pagination-btn,
  .pagination-number {
    padding: 0.5rem 1rem;
    text-decoration: none;
    border: 1px solid #ddd;
    border-radius: 4px;
    color: #333;
    transition: all 0.2s;
  }

  .pagination-btn:hover,
  .pagination-number:hover {
    background-color: #f5f5f5;
    border-color: #007acc;
  }

  .pagination-number.active {
    background-color: #007acc;
    color: white;
    border-color: #007acc;
  }

  .pagination-info {
    text-align: center;
    color: #666;
    font-size: 0.9rem;
  } */
</style>
